pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--a game about sorting colored bombs
--into the correct locations
function _init()
	poke(0x5f2d, 1)
	--array order is black, pink, green, orange
	bombscore = {0,0,0,0} 
	spawntimer = 0
	timer = 10
	lives = 20
	bomblimit = false
	bombs = {}
	cls()
end

--bomb class
function addbomb(_x,_y,_timer)
	add(bombs, {
	 sprite = flr(rnd(4) + 1),
		x = _x,
		y = _y,
		timer = _timer,
		initialtime = _timer,
		grabbable = false,
		held = false,
		dx = 0,
		dy = 1,
		draw = function(self)
			spr(self.sprite,self.x,self.y)
		end,
		timeremaining = function(self)
			self.timer = self.timer - 1
			if self.timer <= (self.initialtime * 0.20) and self.timer > (self.initialtime * 0.05) then
				if self.sprite > 4 then
					self.sprite = self.sprite - 16
				else
					self.sprite = self.sprite + 16
				end
			--if less than 10% of the timer is left blow up the bomb
			elseif self.timer <= (self.initialtime * 0.05) and self.timer > 0 then
			 self.sprite = 10
			elseif	self.timer <= 0 then
				lives -= 1
				del(bombs,self)
			end
		end
		})
end

function box_hit( --function to check for mouse and bomb overlap
  x1,y1, --x1,y1 = mouse x and y
  w1,h1, --w1,h1 = mouse width and heigth
  x2,y2, 
  w2,h2)
  
  hit=false
  local xd=abs((x1+(w1/2))-(x2+(w2/2)))
  local xs=w1*0.5+w2*0.5
  local yd=abs((y1+(h1/2))-(y2+(h2/2)))
  local ys=h1/2+h2/2
  if xd<xs and 
     yd<ys then 
    hit=true 
  end
  
  return hit
end
	 
function _update()
	if lives == 0 then
		gameover()
	end
 spawntimer -= 1
 mousex = stat(32)
 mousey = stat(33)
 if spawntimer <= 0 then
 	addbomb(48 + rnd(25),13,250)
 	spawntimer = 25
 end
 --check if the bomb will blow up and if it can be moved
	for bmb in all(bombs) do
	 --check if the bomb is being held and is grabbable
	 if bmb.held == false then
	 	bmb:timeremaining()
	 end
		bmb.grabbable = box_hit(mousex,mousey,8,8,
			bmb.x, bmb.y, 8,8)
		if bmb.grabbable == true or bmb.held == true then
			cangrabbomb(bmb,mousex,mousey)
		end
		--check if the bomb is inside a defuse location
		if bmb.sprite == 1 then --black bomb
				defuse(bmb,0,24,24,24)
		elseif bmb.sprite == 2 then --pink bomb
			 defuse(bmb,0,72,24,24)
		elseif bmb.sprite == 3 then --green bomb
			 defuse(bmb,96,24,24,24)
		elseif bmb.sprite == 4 then --orange bomb
			 defuse(bmb,96,72,24,24)
		end
		--move the bombs down the conveyor 
	 if box_hit(48,8,28,112,bmb.x,bmb.y,8,8) then
	 	bmb.y += bmb.dy
	 end
	 --bomb reaches end of conveyor
	 if box_hit(48,120,64,8,bmb.x,bmb.y,8,8) then
	 	bmb.y = 8
	 end
	end
end

function gameover()
	_init()
end

function defuse(bomb,x1,y1,w1,h1)
	if box_hit(x1,y1,w1,h1,bomb.x,bomb.y,8,8) 
	 and bomb.held == false then
	 	bombscore[bomb.sprite] += 1 
		 del(bombs,bomb)
	end		
end

function changebombsprite(bomb)
	if bomb.sprite > 4 then
		bomb.sprite = bomb.sprite - 16
	else
		bomb.sprite = bomb.sprite + 16
	end
end

function cangrabbomb(bomb,mousex,mousey)
 --only grab one bomb at a time
 if bomblimit == true and bomb.held == false then
 	return
 end
 --grab bomb with primary key on mouse
 if stat(34) == 1 and bomb.timer > 10 then
  if bomb.sprite > 4 then
  	changebombsprite(bomb)
  end
 	bomb.x = mousex
 	bomb.y = mousey
 	bomb.held = true
 	bomblimit = true
 else
 	bomblimit = false
 	bomb.held = false
 end
end

function _draw()
 cls()
 map(0,0,0,0,16,16)
 --lives ui
 print(lives,64,2,7)
 --score ui
 print(bombscore[1],16,2,7)
 print(bombscore[2],40,2,7)
 print(bombscore[3],96,2,7)
 print(bombscore[4],120,2,7)
 for bmb in all(bombs) do
 	bmb:draw()
 end
 --mouse
 spr(5,stat(32),stat(33))
end
__gfx__
00000000000ff000000ff000000ff000000ff0003333333300000000000000007777777757777777000000000000000000000000000000000000000000000000
00000000007777000077770000777700007777003000000300000000000000006666666656666666009999000099990000000000000000000000000000000000
00000000011111100eeeeee00bbbbbb0099999903000000300000000000000006666666656666666099aa99009aaaa9000999900007000000007700000000000
0000000011611111ee7eeeeebb7bbbbb99799999300000030000000000000000666666665666666609aaaa909aa00aa9099aa990007700000011110000000000
0000000016111111e7eeeeeeb7bbbbbb97999999300000030000000000000000555555555555555509aaaa909a0000a909a00a90007770000011110000000000
0000000016111111e7eeeeeeb7bbbbbb979999993000000300000000000000007777577777775777099aa9909aa00aa9099aa990007777000001100000000000
00000000011111100eeeeee00bbbbbb00999999030000003000000000000000066665666666656660099990009aaaa9000999900007000000000000000000000
000000000011110000eeee0000bbbb00009999003333333300000000000000006666566666665666000000000099990000000000000000000000000000000000
00000000000ff000000ff000000ff000000ff0005777777700000000000000006666666677777775000000000999999000000000000000000000000000000000
00000000007777000077770000777700007777005666666600000000000000006666666666666665000990009aaaaaa900999900088008800000000000000000
00077000088888800ffffff003333330044444405666666600000000000000006666666666666665009999009aa00aa909aaaa90088888800007700000000000
0011110088688888ff7fffff33733333447444445666666600000000000000006666666666666665099aa9909a0000a99aa00aa90888888000eeee0000000000
0011110086888888f7ffffff37333333474444445555555500000000000000006666666655555555099aa9909a0000a99a0000a90088880000eeee0000000000
0001100086888888f7ffffff37333333474444447777577700000000000000006666666677775777009999009aa00aa99aa00aa900088000000ee00000000000
00000000088888800ffffff003333330044444406666566600000000000000006666666666665666000990009aaaaaa909aaaa90000000000000000000000000
000000000088880000ffff0000333300004444006666566600000000000000006666666666665666000000000999999000999900000000000000000000000000
00000000000000000000000000000000666666667777777500000000000000000000000000000000000000000000000009999990000000000000000000000000
0000000000000000000000000000000066666666666666650000000000000000000000000000000000000000000000009aaaaaa9000000000000000000000000
0000000000000000000000000000000066666666666666650000000000000000000000000000000000000000000000009aa00aa9000000000007700000000000
0070700000000000000000000000000066666666666666650000000000000000000000000000000000000000000000009a0000a90000000000bbbb0000000000
0007000000000000000000000000000066666666555555550000000000000000000000000000000000000000000000009a0000a90000000000bbbb0000000000
0070700000000000000000000000000066666666777757770000000000000000000000000000000000000000000000009aa00aa900000000000bb00000000000
0000000000000000000000000000000066666666666656660000000000000000000000000000000000000000000000009aaaaaa9000000000000000000000000
00000000000000000000000000000000666666666666566600000000000000000000000000000000000000000000000009999990000000000000000000000000
6666566666665666666656660000000077777777dddddddd55555555655555560000000000000000000000000000000009999990000000000000000000000000
666656666666566666665666000000006666666655555555dddddddd56666665000000000000000000000000000000009aaaaaa9000000000000000000000000
7777577777775777777757770000000055555555dddddddd5555555556666665000000000000000000000000000000009a0000a9000000000007700000000000
555555555555555555555555000000000000000055555555dddddddd56666665000000000000000000000000000000009a0000a9000000000099990000000000
5666666666666665666666660000000000000000dddddddd5555555556666665000000000000000000000000000000009a0000a9000000000099990000000000
566666666666666566666666555555550000000055555555dddddddd56666665000000000000000000000000000000009a0000a9000000000009900000000000
5666666666666665666666666666666600000000dddddddd5555555556666665000000000000000000000000000000009aaaaaa9000000000000000000000000
577777777777777577777777777777770000000055555555dddddddd655555560000000000000000000000000000000009999990000000000000000000000000
00000000a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0000000000000000000000000
000000000a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a015151515151515151515a0a0e5e5e5e5e5e5e5e5e5e5a0a0b5b5b5b5b5b5b5b5b5b5a0a095959595959595959595a0000000000000000000000000
000000000a515151515151515151510a0a5e5e5e5e5e5e5e5e5e5e0a0a5b5b5b5b5b5b5b5b5b5b0a0a595959595959595959590a000000000000000000000000
00000000a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0000000000000000000000000
000000000a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a000000000000000000000000
__map__
0e20001e20001d2000002e20003e200024242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808253434343409080808080824242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424242424243535353524242424242424242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4142424324243535353524244748484924242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152525324243535353524245758585924242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5152525324243535353524245758585924242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6162626324243535353524246768686924242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424242424243535353524242424242424242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424242424243535353524242424242424242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4445454624243535353524244a4b4b4c24242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5455555624243535353524245a5b5b5c24242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5455555624243535353524245a5b5b5c24242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6465656624243535353524246a6b6b6c24242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424242424243535353524242424242424242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424242424243535353524242424242424242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3232323232313333333330323232323232242424242424242424151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
